import requests
import time
import pandas as pd
import json
url = 'https://music.163.com/weapi/nmusician/statistics/songs/week?csrf_token=5934cf5edd482db20023fbd2521586c3'

headers = {
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36',
    'Referer': 'https://music.163.com/musician/artist/dataCenter',
    'cookie':'csrfToken=2DAtnMy5Zwgnk3QDYTdHG9N1; JSESSIONID-WYYY=ephKb7q1BEzaJaBnFlWJUSTTbDYRw8wnRG5yEy%5CYDEvtdo9hIAJsOZOQuBaDv4Bp7WdjqQC1pbQhXsjzI%5CQ4%5CUeCzSCGFSM7fZYjcbok4M3AjN%5CxI7%5Cgck8ubp6S%2Bi4xbXiMtU4nwvdSglVQB9IYoVabc2Bgv0buVjkFdnFp26VPX%5CHD%3A1751464136256; _iuqxldmzr_=32; _ntes_nnid=f981c6b932c1d185c2e1a04e41580127,1751462336432; _ntes_nuid=f981c6b932c1d185c2e1a04e41580127; NMTID=00OZhge2uGmn6WzF0hyvamJFQoa2RwAAAGXy0phIw; WEVNSM=1.0.0; WNMCID=cjelvj.1751462339340.01.0; __snaker__id=F62IUXgXMKNyOcaa; WM_NI=3lyDnlncEzdFSfbDZams51MB8rPmTnAOL9QKb1YSMATPGP%2FzX0k2cDf6NiNN7f5tA46hl9MUQWO%2BRxzkQU0I2XpMOM%2FLj5h7O3lsL1kBClaRn86qUyfPoJAeUnlkT4jFZ2w%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eeb6e142b8f1a193ca3ef2bc8fb3d45a978e9e82c76ab699a0aae73badadfbabf32af0fea7c3b92af1b4b7a5ed68aebd8b9be74e91baaea5d96bafadfbd2d04afcaea08ed766839184dad441a2ef97b4d04b989089b1ae729cf0a5d3e250a6ea828acd46f5bafb95c440f6b8a4dad05f938981ccd174bab59fb6b343f288c0aece47ed94a6d6eb3d8deda494cf3ba99e8d8de45aaee8fa92d873a690a1abc46f97b2a48cd740aa9a96d3f637e2a3; WM_TID=%2FP7biOrDwc5EAQEUBReHP%2BHPZdh592d%2B; gdxidpyhxdE=fyVG2r%2Bg3tG8Nf2YMXerruW73%2F3ApLxSrjVfVjJ8Ha0ezlcXjBG%2FPZsJuHmaxQ0S4k1zzKnmhd5tM%5CL%2BUMI87oc2ZdsgXo0qdTOx0DTWnEMCW8Au6WW76JN8NqtB7iWuzJNtknCZ%2FHYYePsL2TPH%5CovDYpVIEGmvbxuNggZAuhd64vLO%3A1751463240580; sDeviceId=YD-ydUnRsRenRhAA1RUQEPTevCeYdl6XW90; ntes_utid=tid._.u4pgrZFPXwRBV1EFQVfHa%252FHPdYkuSFaT._.0; MUSIC_U=001526A553F5F1C0BB0E6C3F2152049EBED30E402E1A66C50B1979C37F32E460C73872D4058D1245DF8E57C4B48EDDB75B3D0028534ED6BF627F8870E151F1C0BA0FBB0273E60CCA5C928A84C79D4ABF19FA0C3AE70160255B2300F73ACE603345CDBD506E955D65AC1B44D6FC3E3FA3344CE5740E182EC5640E22E52CF54C8E708718749F8896C51B948BFDABFE06F53DE26DE30841C25DA27541648FBEBD5E2A97B868ACF9836A44699AF6DDC0BDB4766F50AFDC8B10BC313E91BFACFFC5D44BC04CC0A85ADC68C7672FD1803E3AF1A69B956CA37E5041C52A896C9450A14227D1147B24A47808818CD0C59944614EF100C4494BE0B4F0E003F078E2E4D2F17743D36F3E34B0A22EBBFB64521F8294BDCFECA3134F8A0B2E6F50EE58495CDC891AF5590F6433655DFE0B69A16BC8048F0E15CEB527CE2921CE82260029A6A60BF8111F2F2ADAEC81BF00B1A575483C4224A29A6191890891FDBE5CE0042837EA; __csrf=5934cf5edd482db20023fbd2521586c3',
    'content-type':'application/x-www-form-urlencoded'
}

data_payload = {
    'params': 'Yip29TA5eWn3UqsHfWXCmqM8I3iFFYnroboKggaK8ofRvBc1CV/JHzPFk0lU2exgPpE+OtcOwP7sd/XxVyo2ZJdeDsqMfMRC0EDvAO3gPJkeUIs7aIhRYkpnfFNOwc8lhHJMfOUmdzrJvsgtaZvrZmYCJCRhSOu1NzRwUVvnEe0p9cKF+pvy6Ppg8NhPiAPI1K4YuaVx2FT1tq5gdjqLML9GIJ52nxgY8b5Jo7URxlw=',
    'encSecKey': '95d50a72469e5bfa09391cd5a0747602d1a9af693b1fb42ca1117a4b0c2fab8d1d9c7774926321e25ecc775685111ebc8322b252374d5020c9a4293cf5662b40490602f5a92c7102996e84a1e037a8d96715344dcd95e9fe7d4f26f364498f8611cb4b4149f13d214de9f48bcc90130982ecb57fc0b4ece0d062414bf74e63d0'
}
response = requests.post(url, headers=headers,data=data_payload)

data_json= response.json()
songs = data_json["data"]["list"]


df = pd.DataFrame(songs)

# 展示前几行
print(df.head())

# 保存为xlsx文件
df.to_excel('/Users/wangzi/Desktop/top_songs.xlsx', index=False)